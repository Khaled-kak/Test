name: Fetch News Articles
on:
  schedule:
    - cron: '0 */3 * * *' # Toutes les 3 heures
  workflow_dispatch: # Permet de déclencher manuellement

jobs:
  fetch-news:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'

      - name: Install dependencies
        run: npm install axios

      - name: Fetch news articles
        run: |
          node -e "
          const axios = require('axios');
          const fs = require('fs');

          const API_KEY = 'fce4d310a188453eaa6c3118531b7226';
          const QUERY = 'Algérie';
          const LANGUAGE = 'fr';
          const PAGE_SIZE = 20;

          axios.get(\`https://newsapi.org/v2/everything?q=\${QUERY}&language=\${LANGUAGE}&pageSize=\${PAGE_SIZE}&sortBy=publishedAt&apiKey=\${API_KEY}\`)
            .then(response => {
              if (response.data.status === 'ok') {
                fs.writeFileSync('articles.json', JSON.stringify(response.data.articles));
                console.log('Articles mis à jour avec succès.');
              } else {
                console.error('Erreur NewsAPI :', response.data);
              }
            })
            .catch(error => {
              console.error('Erreur lors de la récupération des articles :', error);
            });
          "

      - name: Commit and push changes
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add articles.json
          git commit -m 'Mise à jour des articles'
          git push
